# 二手车数据分析实验报告

## 一、实验目标
1. 掌握Python分组和聚合的基本原理和方法
2. 掌握机器学习回归分析的基本原理方法

## 二、实验内容
1. 对二手车销售数据集进行分组和聚合分析
2. 分析某品牌二手车使用年限、驾驶里程和价格之间的关系

## 三、实验重点和难点
- 数据分组和聚合
- 机器学习的基本概念
- 线性回归、多项式回归、多元回归

---

## 四、实验步骤与结果

### 1. 数据分组和聚合分析

#### 实验代码
文件：`grouping_aggregation.py`

主要功能：
- 数据加载与预处理
- 按品牌分组聚合分析
- 按车龄分组聚合分析
- 按里程分组聚合分析
- 多维度分组聚合分析（品牌 + 车龄）
- 数据可视化
- 高级聚合分析（透视表和热力图）

#### 实验结果

**数据集基本信息：**
- 数据集形状：(22000, 4)
- 包含字段：Name, Year, Miles, Price

**主要发现：**

1. **品牌分布（前5名）：**
   - Toyota: 2636辆
   - Nissan: 2484辆
   - Honda: 1972辆
   - Hyundai: 1761辆
   - Chevrolet: 1704辆

2. **车龄与价格关系：**
   - 0-3年：平均价格最高
   - 3-5年：价格开始下降
   - 5-8年：价格继续下降
   - 8年以上：价格最低
   - **结论：车龄越大，价格越低**

3. **里程与价格关系：**
   - 0-3万英里：平均价格最高
   - 3-6万英里：价格下降
   - 6-9万英里：价格继续下降
   - 9万英里以上：价格最低
   - **结论：里程越高，价格越低**

**生成的可视化图表：**
- `分组聚合分析结果.png`：包含6个子图
  - 各品牌车辆数量分布
  - 热门品牌平均价格对比
  - 不同车龄分组的平均价格
  - 不同里程分组的平均价格
  - 热门品牌价格分布箱线图
  - 里程与价格关系散点图

- `价格热力图.png`：热门品牌不同车龄的平均价格热力图

---

### 2. 回归分析

#### 实验代码
文件：`regression_analysis.py`

主要功能：
- 线性回归分析（车龄 vs 价格）
- 线性回归分析（里程 vs 价格）
- 多项式回归分析（2次、3次、4次）
- 多元回归分析（车龄 + 里程 vs 价格）
- 模型性能对比
- 相关性分析

#### 实验结果

**选择品牌：Ford（福特）**
- 原始数据：1637辆
- 移除异常值后：1525辆

**数据统计描述：**
```
           Age        Miles        Price
count  1525.00     1525.00     1525.00
mean      7.61    61309.71    18944.87
std       2.58    27271.87     3934.78
min       2.00     4456.00    11590.00
25%       6.00    42292.00    15990.00
50%       8.00    54983.00    17990.00
75%       9.00    83320.00    20990.00
max      15.00   106396.00    31990.00
```

#### 2.1 线性回归分析：车龄 vs 价格

**回归方程：**
```
Price = 25574.76 - 866.87 × Age
```

**模型性能：**
- 训练集 R²: 0.3217
- 测试集 R²: 0.2446
- 测试集 RMSE: $3342.76
- 测试集 MAE: $2599.39

**结论：**
- 车龄每增加1年，价格平均下降$866.87
- R²为0.2446，说明车龄可以解释约24.46%的价格变化
- 模型拟合度一般，说明价格还受其他因素影响

#### 2.2 线性回归分析：里程 vs 价格

**回归方程：**
```
Price = 22329.27 - 0.054564 × Miles
```

**模型性能：**
- 训练集 R²: 0.1413
- 测试集 R²: 0.1541
- 测试集 RMSE: $3537.30
- 测试集 MAE: $2804.87

**结论：**
- 里程每增加1英里，价格平均下降$0.055
- R²为0.1541，说明里程可以解释约15.41%的价格变化
- 里程对价格的解释能力低于车龄

#### 2.3 多项式回归分析：车龄 vs 价格

测试了2次、3次、4次多项式回归：

| 多项式阶数 | 训练集 R² | 测试集 R² | 测试集 RMSE |
|-----------|----------|----------|------------|
| 2次       | 0.3595   | 0.3039   | $3208.97   |
| 3次       | 0.3621   | 0.3105   | $3193.70   |
| 4次       | 0.3632   | 0.3094   | $3196.17   |

**最佳模型：3次多项式回归**
- 测试集 R²: 0.3105
- 测试集 RMSE: $3193.70

**结论：**
- 多项式回归比线性回归表现更好
- 3次多项式达到最佳性能
- 4次多项式出现轻微过拟合（测试集R²下降）

#### 2.4 多元回归分析：车龄 + 里程 vs 价格

**回归方程：**
```
Price = 26302.30 - 758.59 × Age - 0.025467 × Miles
```

**模型性能：**
- 训练集 R²: 0.3475
- 测试集 R²: 0.2816
- 测试集 RMSE: $3259.95
- 测试集 MAE: $2602.73

**结论：**
- 同时考虑车龄和里程，车龄每增加1年，价格下降$758.59
- 里程每增加1英里，价格下降$0.025
- R²为0.2816，比单独使用车龄或里程的效果更好
- 说明车龄和里程共同影响价格

#### 2.5 模型性能对比

| 模型 | R² (测试集) | RMSE (测试集) |
|------|------------|--------------|
| 线性回归 (车龄) | 0.2446 | $3342.76 |
| 线性回归 (里程) | 0.1541 | $3537.30 |
| 3次多项式回归 (车龄) | **0.3105** | **$3193.70** |
| 多元线性回归 (车龄+里程) | 0.2816 | $3259.95 |

**最佳模型：3次多项式回归（车龄）**
- 具有最高的R²值（0.3105）
- 具有最低的RMSE（$3193.70）

#### 2.6 特征相关性分析

**相关系数矩阵：**
```
          Age      Miles     Price
Age     1.000    0.412    -0.555
Miles   0.412    1.000    -0.381
Price  -0.555   -0.381     1.000
```

**结论：**
- **车龄与价格**：中等负相关（-0.555），车龄越大，价格越低
- **里程与价格**：弱负相关（-0.381），里程越高，价格越低
- **车龄与里程**：中等正相关（0.412），车龄越大，里程越高（符合常识）

**生成的可视化图表：**
- `回归分析结果.png`：包含6个子图
  1. 线性回归：车龄 vs 价格
  2. 线性回归：里程 vs 价格
  3. 3次多项式回归：车龄 vs 价格
  4. 多元回归：预测值 vs 实际值
  5. 多元回归残差分析
  6. 模型性能对比（R² Score）

- `特征相关性热力图.png`：Ford品牌二手车特征相关性热力图

---

## 五、实验总结

### 主要发现

1. **数据分组和聚合分析：**
   - 成功对22000条二手车数据进行了多维度分组聚合分析
   - 发现车龄和里程是影响价格的重要因素
   - 不同品牌的价格差异显著

2. **回归分析：**
   - **线性回归**：简单直观，但拟合度一般
   - **多项式回归**：3次多项式表现最佳，R²达到0.3105
   - **多元回归**：综合考虑多个特征，效果优于单特征线性回归
   - 车龄对价格的影响（-0.555）大于里程（-0.381）

3. **模型选择：**
   - 对于Ford品牌二手车，3次多项式回归（车龄）是最佳模型
   - 如果需要考虑多个特征，多元线性回归是不错的选择
   - 所有模型的R²都在0.15-0.31之间，说明价格还受其他因素影响（如车况、配置等）

### 技能掌握

1. **分组和聚合：**
   - ✅ 掌握了 `groupby()` 的使用
   - ✅ 掌握了 `agg()` 进行多种聚合操作
   - ✅ 掌握了 `pivot_table()` 进行透视分析
   - ✅ 掌握了多维度分组分析

2. **回归分析：**
   - ✅ 掌握了线性回归的原理和实现
   - ✅ 掌握了多项式回归的原理和实现
   - ✅ 掌握了多元回归的原理和实现
   - ✅ 掌握了模型评估指标（R²、RMSE、MAE）
   - ✅ 掌握了残差分析方法

3. **数据可视化：**
   - ✅ 使用matplotlib创建多种图表
   - ✅ 使用seaborn创建热力图
   - ✅ 掌握了回归分析的可视化方法

### 改进方向

1. 可以尝试更多特征工程（如品牌编码、车型分类等）
2. 可以尝试其他机器学习算法（如决策树、随机森林等）
3. 可以进行更深入的异常值处理和数据清洗
4. 可以考虑交叉验证来更准确地评估模型性能

---

## 六、实验文件清单

1. **代码文件：**
   - `grouping_aggregation.py` - 分组和聚合分析代码
   - `regression_analysis.py` - 回归分析代码

2. **数据文件：**
   - `carvana.csv` - 二手车销售数据集

3. **结果文件：**
   - `regression_results.txt` - 回归分析详细结果
   - `grouping_results.txt` - 分组聚合详细结果
   - `分组聚合分析结果.png` - 分组聚合可视化图表
   - `回归分析结果.png` - 回归分析可视化图表
   - `特征相关性热力图.png` - 特征相关性热力图

4. **报告文件：**
   - `实验报告.md` - 本实验报告

---

**实验完成日期：** 2025-12-17
